{{!-- Header is included in layouts/admin.hbs --}}

<div class="min-h-screen bg-background text-textColor pb-12">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <main id="main-content" role="main">
      <!-- Subheader section -->
      <header class="mb-8 flex justify-between items-center">
        <h1 class="text-3xl font-bold text-textColor">Manage Posts</h1>
        <a href="/admin/posts/create"
          class="inline-flex items-center px-4 py-3 bg-primary hover:bg-accent text-white text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-accent">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
              clip-rule="evenodd" />
          </svg>
          Write New Post
        </a>
      </header>

      <!-- Flash Messages -->
      {{#if success_msg}}
      <div class="bg-green-500/20 text-green-700 dark:bg-green-500/30 dark:text-green-300 p-4 mb-6 rounded-lg border border-green-700/30 dark:border-green-500/50" role="alert"
        aria-live="polite">
        {{success_msg}}
      </div>
      {{/if}}
      {{#if error_msg}}
      <div class="bg-red-500/20 text-red-700 dark:bg-red-500/30 dark:text-red-300 p-4 mb-6 rounded-lg border border-red-700/30 dark:border-red-500/50" role="alert" aria-live="polite">
        {{error_msg}}
      </div>
      {{/if}}

      <!-- Posts listing -->
      <div class="bg-cardBackground rounded-lg border border-borderColor overflow-hidden shadow-lg">
        {{#if posts.length}}
        <table class="min-w-full divide-y divide-borderColor">
          <thead>
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-textSecondary uppercase tracking-wider">
                Title
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-textSecondary uppercase tracking-wider">
                Date
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-textSecondary uppercase tracking-wider">
                Status
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-textSecondary uppercase tracking-wider">
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-borderColor">
            {{#each posts}}
            <tr class="hover:bg-background transition-colors">
              <td class="px-6 py-4 max-w-xs ">
                {{!-- debug --}}
                <a href="/post/{{slug}}" target="_blank" class="text-sm font-medium text-textColor truncate hover:text-primary hover:underline block">{{title}}</a>
                <div class="text-sm text-textSecondary truncate">{{truncate slug 30}}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-textSecondary">
                {{formatDate createdAt "MMMM D, YYYY"}}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {{#if published}}bg-green-500/30 text-green-700 dark:bg-green-500/40 dark:text-green-200{{else}}bg-yellow-500/30 text-yellow-700 dark:bg-yellow-500/40 dark:text-yellow-200{{/if}}">
                  {{#if published}}Published{{else}}Draft{{/if}}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2 w-48">
                <a href="/admin/posts/edit/{{_id}}" class="inline-block px-3 py-1.5 rounded-md text-accent hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-cardBackground focus:ring-accent">
                  Edit
                </a>
                <a href="/post/{{slug}}" target="_blank" class="inline-block px-3 py-1.5 rounded-md text-purple-500 hover:text-purple-400 dark:text-purple-400 dark:hover:text-purple-300 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-cardBackground focus:ring-purple-500">
                  View
                </a>
                <form action="/admin/posts/delete/{{_id}}" method="POST" class="inline"
                  onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
                  <button type="submit" class="px-3 py-1.5 rounded-md text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-cardBackground focus:ring-red-500">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        {{else}}
        <div class="p-8 text-center">
          <p class="text-textSecondary">No posts available. Create your first post!</p>
        </div>
        {{/if}}
      </div>
    </main>
  </div>
</div>